# Библиотека для обработки данных, полученных из аналогово-цифровых преобразователей *UNIT_NAME* компании "*COMPANY_NAME*"

## Дисклеймер

Данная библиотека разработана в процессе реверс-инжиниринга архивов, скопированных из внутренний памяти АЦП штатными средствами (путем втыкания флешки в USB-разъем, расположенный на АЦП). В наличии находится всего два АЦП, поэтому вполне допустимы какие-то ошибки, связанные с пониманием структуры архива в связи с недостаточно репрезентативной выборкой данных.

## Структура архива .AR4

Архив .AR4 представляет собой бинарный файл размером 67 109 120 байт, в котором данные структурированы в фрагментах по 256 байт. В первом фрагменте находится информация о самом приборе: серийный номер, дата создания архива и текстовое поле, с помощью которого можно идентифицировать конкретный прибор в других программах. В качестве примера рассмотрим первый фрагмент длиной в 256 байт одного из АЦП (для удобства восприятия байты сгруппированы):

`61720001 00000004 00000000 0100011d 00004a00 01065de8 485e315c 40000000 00000000 00000000 00001053 54454e44 20202020 20202020 20202000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00003232 32320000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000`

`6172 0001 0000 0004 0000 0000 0100 011d 0000 4a00 0106 **5de8 485e** **315c 4000** 0000 0000 0000 0000 0000 0000 **10 5354 454e 4420 2020 2020 2020 2020 2020** 00 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 3232 3232 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000`

`6172000100000004000000000100011d00004a000106 5de8485e 315c4000 000000000000000000000000 10 5354454e442020202020202020202020 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000323232320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`



315c 4000 - номер прибора (справа налево) [26:30]

5de8 485e - дата создания архива (справа налево) [22:26];

10 - количество байт текста (16 в десятичной системе счисления) [42:43]

53 54454e44 20202020 20202020 202020 - текст (слева направо, 20 - код пробельного символа) [43:59]

После первого фрагмента байт идут фрагменты, видимо, содержащие какую-то служебную информацию:

`a54bffffffff0000ffff067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20ed067f20edf8a54bffffffff010000103a0f26d900000000390cd91f39d83084b98e1e78390db191390d671e39d2797ab98cab3c00000000398f1b81b99004460690044600000000000000003a3009c116a54bffffffff01000000390f27650000000000000000b9906b8b398e1e8ab90e885500000000b98c52e500000000000000000000000000000000b91040ec0000000039d9e8f5b98d00e78effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff`

`a54b ffff ffff 0000 ffff 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed 067f 20ed f8a5 4bff ffff ff01 0000 103a 0f26 d900 0000 0039 0cd9 1f39 d830 84b9 8e1e 7839 0db1 9139 0d67 1e39 d279 7ab9 8cab 3c00 0000 0039 8f1b 81b9 9004 4606 9004 4600 0000 0000 0000 003a 3009 c116 a54b ffff ffff 0100 0000 390f 2765 0000 0000 0000 0000 b990 6b8b 398e 1e8a b90e 8855 0000 0000 b98c 52e5 0000 0000 0000 0000 0000 0000 0000 0000 b910 40ec 0000 0000 39d9 e8f5 b98d 00e7 8eff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff ffff`

## Модуль ar4_parser.py

Класс **Ar4Parser** содержит методы, позволяющие декодировать архив формата **.AR4**, извлечь из него данные за заданный временной интервал, за указанную дату, за последнюю представленную в архиве дату или разбить архив на данные по датам.

## TODO:

1. Согласовать типы данных через mypy;
2. Реализовать прореживание данных;
3. Реализовать интерфейс командной строки;
4. Реализовать построение графиков по извлеченным данным.
